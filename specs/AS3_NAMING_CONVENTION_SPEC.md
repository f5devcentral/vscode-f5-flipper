# AS3 Naming Convention Specification

**Status**: APPROVED
**Created**: 2026-01-15
**Related**: [DIRECT_CONVERSION_ADR.md](DIRECT_CONVERSION_ADR.md), [DIRECT_CONVERSION_IMPL_SPEC.md](DIRECT_CONVERSION_IMPL_SPEC.md)

---

## Executive Summary

This specification defines the naming conventions for AS3 objects generated by Flipper's direct conversion engine. The naming pattern prioritizes **predictable searching** and **consistent structure** across all generated AS3 declarations.

---

## Table of Contents

1. [Design Goals](#1-design-goals)
2. [Naming Pattern Overview](#2-naming-pattern-overview)
3. [Object Naming Rules](#3-object-naming-rules)
4. [Protocol Abbreviations](#4-protocol-abbreviations)
5. [Profile Abbreviations](#5-profile-abbreviations)
6. [Port Handling](#6-port-handling)
7. [Examples](#7-examples)
8. [Configuration Options](#8-configuration-options)
9. [Name Sanitization](#9-name-sanitization)
10. [Implementation Notes](#10-implementation-notes)

---

## 1. Design Goals

### Primary Goals

1. **Predictable Searching** - Given an app name, users can predict all related object names
2. **Consistent Structure** - All objects follow `{app}_{protocol}{port}_{suffix}` pattern
3. **Type Identification** - Suffix immediately identifies object type (`_vs`, `_pool`, etc.)
4. **Protocol Visibility** - Protocol/port in name aids troubleshooting and filtering

### Secondary Goals

1. **AS3 Compliance** - All names valid per AS3 schema (alphanumeric + underscore)
2. **Length Limits** - Stay within AS3's 64-character limit (target: 48 chars)
3. **Configurable** - Power users can override defaults via options
4. **Backward Compatible** - Clear migration path from existing naming

---

## 2. Naming Pattern Overview

### Core Pattern

```
{app_name}_{protocol}{port}_{suffix}
```

| Component | Description | Example |
|-----------|-------------|---------|
| `app_name` | Sanitized application name from NetScaler | `web_app`, `api_server` |
| `protocol` | Lowercase protocol abbreviation | `tcp`, `http`, `ssl` |
| `port` | Port number (omit for wildcard/0) | `443`, `80`, `8080` |
| `suffix` | Object type identifier | `_vs`, `_pool`, `_mon` |

### Object Type Suffixes

| Object Type | Suffix | Full Pattern | Example |
|-------------|--------|--------------|---------|
| Tenant | (none) | `t_{app_name}` | `t_web_app` |
| Application | (none) | `{app_name}_{protocol}{port}` | `web_app_tcp443` |
| Virtual Server | `_vs` | `{app_name}_{protocol}{port}_vs` | `web_app_tcp443_vs` |
| Pool | `_pool` | `{app_name}_{protocol}{port}_pool` | `web_app_tcp443_pool` |
| Monitor | `_mon` | `{app_name}_{mon_type}_mon` | `web_app_http_mon` |
| iRule | `_ir` | `{app_name}_{protocol}{port}_ir` | `web_app_http80_ir` |
| SNAT Pool | `_snat` | `{app_name}_{protocol}{port}_snat` | `web_app_tcp443_snat` |

---

## 3. Object Naming Rules

### 3.1 Tenant

**Pattern**: `{prefix}_{app_name}`

```
t_web_app
t_api_server
t_forwarder
```

- Default prefix: `t`
- Configurable via `tenantPrefix` option
- Does NOT include protocol/port (tenant groups the app)

### 3.2 Application

**Pattern**: `{app_name}_{protocol}{port}`

```
web_app_tcp443
api_server_http8080
forwarder_icmp
forwarder_tcp
```

- Includes protocol and port for disambiguation
- Omit port for wildcard (`*` or `0`) - just use protocol
- Multiple apps with different protocols/ports get unique names

### 3.3 Virtual Server

**Pattern**: `{app_name}_{protocol}{port}_vs`

```
web_app_tcp443_vs
api_server_http8080_vs
forwarder_icmp_vs
forwarder_tcp_vs
```

- Always ends with `_vs` suffix
- Matches Application name + `_vs`

### 3.4 Pool

**Pattern**: `{app_name}_{protocol}{port}_pool`

```
web_app_tcp443_pool
api_server_http8080_pool
```

- Always ends with `_pool` suffix
- Only created when app has pool members

### 3.5 Monitor

**Pattern**: `{app_name}_{mon_type}_mon` or `{mon_name}_mon`

```
web_app_http_mon
api_server_tcp_mon
custom_health_check_mon
```

- Uses monitor type (http, tcp, https) when derived from app
- Uses original monitor name when referencing existing NS monitor
- Always ends with `_mon` suffix

### 3.6 Multiple Objects per App

When an app requires multiple objects of the same type (e.g., multiple monitors):

**Pattern**: `{app_name}_{identifier}_{suffix}`

```
web_app_http_mon
web_app_tcp_mon
web_app_custom_mon
```

---

## 4. Protocol Abbreviations

### Standard Protocols

| NetScaler Protocol | Abbreviation | Example |
|--------------------|--------------|---------|
| `HTTP` | `http` | `app1_http80_vs` |
| `SSL` | `ssl` | `app1_ssl443_vs` |
| `SSL_BRIDGE` | `sslb` | `app1_sslb443_vs` |
| `SSL_TCP` | `sslt` | `app1_sslt443_vs` |
| `TCP` | `tcp` | `app1_tcp8080_vs` |
| `UDP` | `udp` | `app1_udp53_vs` |
| `DNS` | `dns` | `app1_dns53_vs` |
| `DNS_TCP` | `dnst` | `app1_dnst53_vs` |
| `FTP` | `ftp` | `app1_ftp21_vs` |
| `ANY` | `any` | `forwarder_any_vs` |

### Extended Protocols

| NetScaler Protocol | Abbreviation | Example |
|--------------------|--------------|---------|
| `SIP_UDP` | `sipu` | `voip_sipu5060_vs` |
| `SIP_TCP` | `sipt` | `voip_sipt5060_vs` |
| `SIP_SSL` | `sips` | `voip_sips5061_vs` |
| `RADIUS` | `rad` | `auth_rad1812_vs` |
| `RDP` | `rdp` | `remote_rdp3389_vs` |
| `RTSP` | `rtsp` | `media_rtsp554_vs` |
| `MYSQL` | `mysql` | `db_mysql3306_vs` |
| `MSSQL` | `mssql` | `db_mssql1433_vs` |
| `ORACLE` | `oracle` | `db_oracle1521_vs` |
| `DIAMETER` | `diam` | `telco_diam3868_vs` |
| `SMPP` | `smpp` | `sms_smpp2775_vs` |
| `FIX` | `fix` | `trading_fix9876_vs` |

### ICMP/Forwarding

| Type | Abbreviation | Example |
|------|--------------|---------|
| ICMP forwarding | `icmp` | `forwarder_icmp_vs` |
| All traffic | `any` | `forwarder_any_vs` |

---

## 5. Profile Abbreviations

When profiles are referenced or created, use these abbreviations:

### Traffic Profiles

| Profile Type | Abbreviation | Full Name Example |
|--------------|--------------|-------------------|
| Local Traffic Policy | `_ltp` | `web_app_tcp443_ltp` |
| HTTP Profile | `_httpp` | `web_app_http_httpp` |
| TCP Profile | `_tcpp` | `web_app_tcp_tcpp` |
| UDP Profile | `_udpp` | `app_udp_udpp` |
| FastL4 Profile | `_fl4p` | `forwarder_any_fl4p` |
| OneConnect | `_ocp` | `web_app_http_ocp` |

### SSL/TLS Profiles

| Profile Type | Abbreviation | Full Name Example |
|--------------|--------------|-------------------|
| Client SSL | `_cssl` | `web_app_ssl443_cssl` |
| Server SSL | `_sssl` | `web_app_ssl443_sssl` |

### Persistence Profiles

| Persistence Type | Abbreviation | Full Name Example |
|-----------------|--------------|-------------------|
| Source Address | `_psrc` | `web_app_tcp443_psrc` |
| Cookie | `_pcook` | `web_app_http80_pcook` |
| SSL Session | `_pssl` | `web_app_ssl443_pssl` |
| Universal | `_puniv` | `web_app_tcp8080_puniv` |
| Destination Address | `_pdst` | `web_app_tcp443_pdst` |

### Other Profiles

| Profile Type | Abbreviation | Full Name Example |
|--------------|--------------|-------------------|
| SNAT Pool | `_snat` | `web_app_tcp443_snat` |
| iRule | `_ir` | `web_app_http80_ir` |
| Data Group | `_dg` | `web_app_whitelist_dg` |
| Certificate | `_cert` | `web_app_wildcard_cert` |

---

## 6. Port Handling

### Standard Port Inclusion

```
{app_name}_{protocol}{port}_{suffix}
```

| Scenario | Port Value | Result |
|----------|------------|--------|
| Standard port | `443` | `app_ssl443_vs` |
| Standard port | `80` | `app_http80_vs` |
| Non-standard | `8443` | `app_ssl8443_vs` |
| Non-standard | `8080` | `app_http8080_vs` |

### Wildcard/Any Port

When port is `*` or `0`, omit the port number:

| Port Value | Result |
|------------|--------|
| `*` | `forwarder_tcp_vs` |
| `0` | `forwarder_any_vs` |

### Port Ranges (Future)

If port ranges are supported in future:

```
app_tcp1000_2000_vs  (ports 1000-2000)
```

---

## 7. Examples

### 7.1 Simple HTTP Application

**Input**: `web_app`, HTTP, port 80, with pool

```json
{
  "t_web_app": {
    "class": "Tenant",
    "web_app_http80": {
      "class": "Application",
      "web_app_http80_vs": {
        "class": "Service_HTTP",
        "virtualAddresses": ["10.1.1.100"],
        "virtualPort": 80,
        "pool": "web_app_http80_pool"
      },
      "web_app_http80_pool": {
        "class": "Pool",
        "members": [...],
        "monitors": [{ "use": "web_app_http_mon" }]
      },
      "web_app_http_mon": {
        "class": "Monitor",
        "monitorType": "http"
      }
    }
  }
}
```

### 7.2 SSL Application with Profiles

**Input**: `secure_app`, SSL, port 443

```json
{
  "t_secure_app": {
    "class": "Tenant",
    "secure_app_ssl443": {
      "class": "Application",
      "secure_app_ssl443_vs": {
        "class": "Service_HTTPS",
        "virtualAddresses": ["10.1.1.101"],
        "virtualPort": 443,
        "pool": "secure_app_ssl443_pool",
        "serverTLS": { "bigip": "/Common/secure_app_cssl" }
      },
      "secure_app_ssl443_pool": {
        "class": "Pool",
        "members": [...],
        "monitors": [{ "use": "secure_app_https_mon" }]
      },
      "secure_app_https_mon": {
        "class": "Monitor",
        "monitorType": "https"
      }
    }
  }
}
```

### 7.3 Forwarder with Multiple Protocols

**Input**: `forwarder`, ICMP + TCP (wildcard port)

```json
{
  "t_forwarder": {
    "class": "Tenant",
    "forwarder_icmp": {
      "class": "Application",
      "forwarder_icmp_vs": {
        "class": "Service_L4",
        "virtualAddresses": ["0.0.0.0"],
        "virtualPort": 0
      }
    },
    "forwarder_tcp": {
      "class": "Application",
      "forwarder_tcp_vs": {
        "class": "Service_TCP",
        "virtualAddresses": ["0.0.0.0"],
        "virtualPort": 0
      }
    }
  }
}
```

### 7.4 Application with Custom Monitor

**Input**: `api_server`, HTTP, port 8080, custom monitor `api_health_check`

```json
{
  "t_api_server": {
    "class": "Tenant",
    "api_server_http8080": {
      "class": "Application",
      "api_server_http8080_vs": {
        "class": "Service_HTTP",
        "virtualAddresses": ["10.1.1.102"],
        "virtualPort": 8080,
        "pool": "api_server_http8080_pool"
      },
      "api_server_http8080_pool": {
        "class": "Pool",
        "members": [...],
        "monitors": [{ "use": "api_health_check_mon" }]
      },
      "api_health_check_mon": {
        "class": "Monitor",
        "monitorType": "http",
        "send": "GET /health HTTP/1.1\\r\\nHost: api.example.com\\r\\n\\r\\n",
        "receive": "UP"
      }
    }
  }
}
```

### 7.5 Database Application

**Input**: `db_cluster`, MYSQL, port 3306

```json
{
  "t_db_cluster": {
    "class": "Tenant",
    "db_cluster_mysql3306": {
      "class": "Application",
      "db_cluster_mysql3306_vs": {
        "class": "Service_TCP",
        "virtualAddresses": ["10.1.1.103"],
        "virtualPort": 3306,
        "pool": "db_cluster_mysql3306_pool"
      },
      "db_cluster_mysql3306_pool": {
        "class": "Pool",
        "members": [...],
        "monitors": [{ "use": "db_cluster_mysql_mon" }]
      },
      "db_cluster_mysql_mon": {
        "class": "Monitor",
        "monitorType": "mysql"
      }
    }
  }
}
```

---

## 8. Configuration Options

### NamingOptions Interface

```typescript
export interface NamingOptions {
  /** Tenant name prefix (default: 't') */
  tenantPrefix?: string;

  /** Include protocol in object names (default: true) */
  includeProtocol?: boolean;

  /** Include port in object names (default: true) */
  includePort?: boolean;

  /** Separator between name components (default: '_') */
  separator?: string;

  /** Custom protocol abbreviations (merge with defaults) */
  protocolAbbreviations?: Record<string, string>;

  /** Custom suffix overrides */
  suffixes?: {
    virtualServer?: string;  // default: '_vs'
    pool?: string;           // default: '_pool'
    monitor?: string;        // default: '_mon'
    iRule?: string;          // default: '_ir'
    snatPool?: string;       // default: '_snat'
    clientSsl?: string;      // default: '_cssl'
    serverSsl?: string;      // default: '_sssl'
    httpProfile?: string;    // default: '_httpp'
    tcpProfile?: string;     // default: '_tcpp'
    localTrafficPolicy?: string; // default: '_ltp'
    persistence?: string;    // default: '_persist'
  };
}
```

### Default Configuration

```typescript
const DEFAULT_NAMING: NamingOptions = {
  tenantPrefix: 't',
  includeProtocol: true,
  includePort: true,
  separator: '_',
  suffixes: {
    virtualServer: '_vs',
    pool: '_pool',
    monitor: '_mon',
    iRule: '_ir',
    snatPool: '_snat',
    clientSsl: '_cssl',
    serverSsl: '_sssl',
    httpProfile: '_httpp',
    tcpProfile: '_tcpp',
    localTrafficPolicy: '_ltp',
    persistence: '_persist',
  },
};
```

### Usage Examples

```typescript
// Default naming
buildAS3(app);
// Output: t_web_app / web_app_http80 / web_app_http80_vs

// Custom tenant prefix
buildAS3(app, { namingOptions: { tenantPrefix: 'ns' } });
// Output: ns_web_app / web_app_http80 / web_app_http80_vs

// Custom suffixes
buildAS3(app, {
  namingOptions: {
    suffixes: {
      virtualServer: '_virtual',
      pool: '_server_pool'
    }
  }
});
// Output: web_app_http80_virtual / web_app_http80_server_pool

// Disable protocol/port in names (legacy style)
buildAS3(app, {
  namingOptions: {
    includeProtocol: false,
    includePort: false
  }
});
// Output: t_web_app / web_app / web_app_vs

// Custom protocol abbreviations
buildAS3(app, {
  namingOptions: {
    protocolAbbreviations: {
      'HTTP': 'h',      // Override: http -> h
      'SSL': 's',       // Override: ssl -> s
      'CUSTOM': 'cust'  // Add new protocol
    }
  }
});
// Output: web_app_h80_vs (instead of web_app_http80_vs)

// Enterprise naming standard example
buildAS3(app, {
  namingOptions: {
    tenantPrefix: 'prod',
    suffixes: {
      virtualServer: '_vip',
      pool: '_pool',
      monitor: '_hm'  // health monitor
    }
  }
});
// Output: prod_web_app / web_app_http80 / web_app_http80_vip / web_app_http80_pool / web_app_http_hm
```

### Configuration Precedence

1. User-provided options override defaults
2. Missing options fall back to defaults
3. Protocol abbreviations are merged (user overrides take precedence)
4. Empty string (`''`) for a suffix removes that suffix entirely

### Validation Rules

- `tenantPrefix`: 1-10 alphanumeric characters
- `separator`: Single character (`_` or `-`)
- `suffixes`: 1-10 characters, must start with `_` or be empty
- `protocolAbbreviations`: Values must be 1-6 lowercase alphanumeric

---

## 9. Name Sanitization

### Rules

1. **Remove quotes** - Strip leading/trailing quotes
2. **Replace special chars** - Replace non-alphanumeric (including `-`) with `_`
3. **Collapse underscores** - Multiple `_` become single `_`
4. **Trim underscores** - Remove leading/trailing `_`
5. **Handle leading digits** - Prefix with `n` if starts with digit
6. **Length limit** - Truncate to 48 characters (allow room for suffixes)

> **Note**: Hyphens (`-`) are converted to underscores for consistency and TMSH compatibility.

### Implementation

```typescript
export function sanitizeName(name: string): string {
  let result = name
    // Remove surrounding quotes
    .replace(/^["']|["']$/g, '')
    // Replace ALL special chars (including hyphens) with underscores
    .replace(/[^a-zA-Z0-9_]/g, '_')
    // Collapse multiple underscores
    .replace(/_+/g, '_')
    // Trim underscores from ends
    .replace(/^_|_$/g, '');

  // Ensure doesn't start with number
  if (/^[0-9]/.test(result)) {
    result = 'n' + result;
  }

  // Handle empty result
  if (!result) {
    result = 'unnamed';
  }

  // Limit length (leave room for protocol/port/suffix)
  return result.substring(0, 48);
}
```

### Sanitization Examples

| Input | Output |
|-------|--------|
| `"web-app"` | `web_app` |
| `web.app.com` | `web_app_com` |
| `my web app` | `my_web_app` |
| `my-web-app` | `my_web_app` |
| `123_app` | `n123_app` |
| `app__name` | `app_name` |
| `app--name` | `app_name` |
| `_app_` | `app` |

---

## 10. Implementation Notes

### Files to Update

1. **`src/as3/builders.ts`** - Core name generation logic
2. **`src/as3/mappings.ts`** - Protocol abbreviation mappings
3. **`src/as3/index.ts`** - Export NamingOptions interface
4. **`tests/061_as3_builders.unit.tests.ts`** - Update expected names
5. **`tests/062_as3_integration.unit.tests.ts`** - Update expected names

### Name Generation Functions

```typescript
// Generate protocol+port segment
function getProtocolPortSegment(protocol: string, port: string | number): string {
  const abbrev = PROTOCOL_ABBREVIATIONS[protocol?.toUpperCase()] || 'tcp';
  const portNum = parseInt(String(port), 10);

  // Omit port for wildcard (0 or *)
  if (portNum === 0 || port === '*') {
    return abbrev;
  }

  return `${abbrev}${portNum}`;
}

// Generate full object name
function generateObjectName(
  appName: string,
  protocol: string,
  port: string | number,
  suffix: string
): string {
  const sanitized = sanitizeName(appName);
  const protoPort = getProtocolPortSegment(protocol, port);
  return `${sanitized}_${protoPort}${suffix}`;
}
```

### Migration from Current Naming

| Object | Old Pattern | New Pattern |
|--------|-------------|-------------|
| Tenant | `t_web_app` | `t_web_app` (unchanged) |
| Application | `app_web_app` | `web_app_http80` |
| Virtual Server | `vs_web_app` | `web_app_http80_vs` |
| Pool | `pool_web_app` | `web_app_http80_pool` |
| Monitor | `mon_http_mon` | `web_app_http_mon` |

### Test Cases Required

1. Standard HTTP application (port 80)
2. Standard HTTPS application (port 443)
3. Non-standard port (8080, 8443)
4. Wildcard port (`*` or `0`)
5. Special characters in app name
6. Very long app names (truncation)
7. Names starting with digits
8. Multiple monitors per app
9. Custom naming options
10. All protocol types

---

## Appendix A: Full Protocol Abbreviation Map

```typescript
export const PROTOCOL_ABBREVIATIONS: Record<string, string> = {
  // Standard protocols
  'HTTP': 'http',
  'SSL': 'ssl',
  'SSL_BRIDGE': 'sslb',
  'SSL_TCP': 'sslt',
  'TCP': 'tcp',
  'UDP': 'udp',
  'DNS': 'dns',
  'DNS_TCP': 'dnst',
  'FTP': 'ftp',
  'ANY': 'any',

  // SIP variants
  'SIP_UDP': 'sipu',
  'SIP_TCP': 'sipt',
  'SIP_SSL': 'sips',

  // Other protocols
  'RADIUS': 'rad',
  'RDP': 'rdp',
  'RTSP': 'rtsp',
  'MYSQL': 'mysql',
  'MSSQL': 'mssql',
  'ORACLE': 'oracle',
  'DIAMETER': 'diam',
  'SMPP': 'smpp',
  'FIX': 'fix',
  'TFTP': 'tftp',
  'PPTP': 'pptp',

  // ADNS
  'ADNS': 'adns',
  'ADNS_TCP': 'adnst',
};
```

---

## Appendix B: Search Pattern Examples

Given these naming conventions, users can predict and search for objects:

| Search Goal | Pattern | Examples Found |
|-------------|---------|----------------|
| All objects for `web_app` | `web_app_*` | `web_app_http80_vs`, `web_app_http80_pool`, `web_app_http_mon` |
| All virtual servers | `*_vs` | `web_app_http80_vs`, `api_tcp8080_vs` |
| All pools | `*_pool` | `web_app_http80_pool`, `api_tcp8080_pool` |
| All HTTP objects | `*_http*` | `web_app_http80_vs`, `web_app_http_mon` |
| All port 443 objects | `*_ssl443_*` | `secure_app_ssl443_vs`, `secure_app_ssl443_pool` |
| All monitors | `*_mon` | `web_app_http_mon`, `api_tcp_mon` |

---

*Naming convention specification. Last updated: 2026-01-15*
