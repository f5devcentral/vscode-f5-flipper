# Section 1.9: Spillover Policies
# Tests: spillover action, spillover policy
# Spillover allows traffic to be redirected to backup when primary pool is full/down

# Backend servers for primary pool
add server spill_server1 10.10.10.80
add server spill_server2 10.10.10.81

# Backend servers for backup pool
add server spill_backup1 10.10.10.90
add server spill_backup2 10.10.10.91

# Primary service group
add serviceGroup sg_spill_primary HTTP
bind serviceGroup sg_spill_primary spill_server1 80
bind serviceGroup sg_spill_primary spill_server2 80

# Backup service group
add serviceGroup sg_spill_backup HTTP
bind serviceGroup sg_spill_backup spill_backup1 80
bind serviceGroup sg_spill_backup spill_backup2 80

# Primary vserver
add lb vserver vs_spillover HTTP 10.1.1.160 80
bind lb vserver vs_spillover sg_spill_primary

# Backup vserver (wildcard address for spillover)
add lb vserver vs_spillover_backup HTTP 0.0.0.0 0
bind lb vserver vs_spillover_backup sg_spill_backup

# Configure spillover settings via set command
set lb vserver vs_spillover -backupVServer vs_spillover_backup -soMethod CONNECTION -soThreshold 100
