# Section 1.8: Audit/Logging Policies
# Tests: audit syslogAction, audit syslogPolicy, audit nslogAction, audit nslogPolicy
# NOTE: HTTP.REQ.IS_VALID is NOT a valid expression - use "true" instead

# Syslog server action (external syslog server)
add audit syslogAction syslog_act_external 10.10.10.100 -serverPort 514 -logLevel ALL -logFacility LOCAL0 -dateFormat MMDDYYYY -timeZone LOCAL_TIME -tcp NONE

# Syslog policy for all traffic (POSITIONAL args: <name> <rule> <action>)
add audit syslogPolicy syslog_pol_http true syslog_act_external

# NSLog action (local logging)
add audit nslogAction nslog_act_local ALERT -logLevel ALL -logFacility LOCAL1 -dateFormat MMDDYYYY -timeZone LOCAL_TIME

# NSLog policy for all requests (POSITIONAL args: <name> <rule> <action>)
add audit nslogPolicy nslog_pol_all true nslog_act_local

# Backend and vserver for testing
add server audit_server 10.10.10.70
add serviceGroup sg_audit HTTP
bind serviceGroup sg_audit audit_server 80
add lb vserver vs_audit HTTP 10.1.1.150 80
bind lb vserver vs_audit sg_audit

# Bind audit policies to vserver
bind lb vserver vs_audit -policyName syslog_pol_http -priority 100 -gotoPriorityExpression END -type REQUEST
bind lb vserver vs_audit -policyName nslog_pol_all -priority 200 -gotoPriorityExpression END -type REQUEST
