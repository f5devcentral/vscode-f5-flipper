#NS13.1 Build 37.38
# Last modified by `save config`, Mon May 03 12:34:56 2555

# TCP Listen Policy Application Configuration
# Example: Wildcard virtual server with selective port filtering via listen policy

# Wildcard Virtual Server with Listen Policy - Accepts traffic only on specified ports
add lb vserver app_multiport_vs TCP 192.168.1.15 * -persistenceType SOURCEIP -timeout 60 -Listenpolicy "CLIENT.TCP.DSTPORT.EQ(80) || CLIENT.TCP.DSTPORT.EQ(443) || CLIENT.TCP.DSTPORT.EQ(4040) || CLIENT.TCP.DSTPORT.EQ(4050) || CLIENT.TCP.DSTPORT.EQ(4065) || CLIENT.TCP.DSTPORT.EQ(4545) || CLIENT.TCP.DSTPORT.EQ(4555) || CLIENT.TCP.DSTPORT.EQ(5656) || CLIENT.TCP.DSTPORT.EQ(6050) || CLIENT.TCP.DSTPORT.EQ(6555) || CLIENT.TCP.DSTPORT.EQ(7050) || CLIENT.TCP.DSTPORT.EQ(7555) || CLIENT.TCP.DSTPORT.EQ(9696)" -cltTimeout 3600 -comment "Multi-port application with selective port filtering" -appflowLog DISABLED

# Service Group for Multi-Port Application
add serviceGroup app_multiport_sg TCP -maxClient 0 -maxReq 0 -cip DISABLED -usip NO -useproxyport YES -cltTimeout 3600 -svrTimeout 3600 -CKA NO -TCPB NO -CMP NO

# Bind service group to virtual server
bind lb vserver app_multiport_vs app_multiport_sg

# Backend Application Servers - Wildcard port bindings
bind serviceGroup app_multiport_sg app_server_1 *
add server app_server_1 10.1.1.205 -comment "Primary application server"

bind serviceGroup app_multiport_sg app_server_2 *
add server app_server_2 10.1.1.203 -comment "Secondary application server"

# Health Monitor - Custom HTTP check on specific port
add lb monitor app_multiport_monitor HTTP-ECV -customHeaders "Host: app.example.com\r\nCache-control: no-cache\r\n" -send "GET /health/check" -recv "OK" -LRTM DISABLED -interval 15 -resptimeout 8 -destPort 5656

# Bind monitor to service group
bind serviceGroup app_multiport_sg -monitorName app_multiport_monitor
