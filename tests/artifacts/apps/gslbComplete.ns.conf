#NS13.1 Build 61.23
# GSLB Complete Configuration - Full GSLB site/service/vserver
# Purpose: Test GSLB parsing and feature detection
# Note: Synthetic config - GSLB requires multi-site deployment

# == GSLB Sites ==
add gslb site site_dc1 10.1.1.1 -publicIP 203.0.113.1 -metricExchange ENABLED -nwMetricExchange ENABLED -sessionExchange ENABLED
add gslb site site_dc2 10.2.2.1 -publicIP 203.0.113.2 -metricExchange ENABLED -nwMetricExchange ENABLED -sessionExchange ENABLED
add gslb site site_dr 10.3.3.1 -publicIP 203.0.113.3 -metricExchange DISABLED

# == Local LB vServers (targets for GSLB) ==
add lb vserver lb_web_dc1 HTTP 10.1.1.100 80
add lb vserver lb_web_dc2 HTTP 10.2.2.100 80
add lb vserver lb_web_dr HTTP 10.3.3.100 80

# == GSLB Services ==
add gslb service gslb_svc_dc1_web site_dc1 10.1.1.100 HTTP 80 -publicIP 203.0.113.10 -publicPort 80 -maxClient 1000 -sitePersistence ConnectionProxy -cip ENABLED X-Forwarded-For
add gslb service gslb_svc_dc2_web site_dc2 10.2.2.100 HTTP 80 -publicIP 203.0.113.20 -publicPort 80 -maxClient 1000 -sitePersistence HTTPRedirect
add gslb service gslb_svc_dr_web site_dr 10.3.3.100 HTTP 80 -publicIP 203.0.113.30 -publicPort 80

# == GSLB Services with SSL ==
add gslb service gslb_svc_dc1_ssl site_dc1 10.1.1.101 SSL 443 -publicIP 203.0.113.11 -publicPort 443
add gslb service gslb_svc_dc2_ssl site_dc2 10.2.2.101 SSL 443 -publicIP 203.0.113.21 -publicPort 443

# == GSLB vServer - Round Robin ==
add gslb vserver gslb_vs_web HTTP -dnsRecordType A -lbMethod ROUNDROBIN -tolerance 0 -persistenceId 1
bind gslb vserver gslb_vs_web -serviceName gslb_svc_dc1_web
bind gslb vserver gslb_vs_web -serviceName gslb_svc_dc2_web
bind gslb vserver gslb_vs_web -serviceName gslb_svc_dr_web

# == GSLB vServer - Proximity Based ==
add gslb vserver gslb_vs_proximity HTTP -dnsRecordType A -lbMethod RTT -netmask 255.255.255.0
bind gslb vserver gslb_vs_proximity -serviceName gslb_svc_dc1_web
bind gslb vserver gslb_vs_proximity -serviceName gslb_svc_dc2_web

# == GSLB vServer - Static Proximity ==
add gslb vserver gslb_vs_static HTTP -dnsRecordType A -lbMethod STATICPROXIMITY
bind gslb vserver gslb_vs_static -serviceName gslb_svc_dc1_web
bind gslb vserver gslb_vs_static -serviceName gslb_svc_dc2_web

# == GSLB vServer - SSL with Backup ==
add gslb vserver gslb_vs_ssl SSL -dnsRecordType A -lbMethod LEASTCONNECTION -backupLBMethod ROUNDROBIN
bind gslb vserver gslb_vs_ssl -serviceName gslb_svc_dc1_ssl
bind gslb vserver gslb_vs_ssl -serviceName gslb_svc_dc2_ssl

# == GSLB Domain Bindings ==
bind gslb vserver gslb_vs_web -domainName www.example.com -TTL 60 -backupIP 10.1.1.100
bind gslb vserver gslb_vs_web -domainName app.example.com -TTL 30
bind gslb vserver gslb_vs_proximity -domainName geo.example.com -TTL 120
bind gslb vserver gslb_vs_ssl -domainName secure.example.com -TTL 60

# == DNS Configuration ==
add dns nsRec example.com ns1.example.com -TTL 86400
add dns nsRec example.com ns2.example.com -TTL 86400
add dns aRec ns1.example.com 203.0.113.1 -TTL 3600
add dns aRec ns2.example.com 203.0.113.2 -TTL 3600
add dns soaRec example.com ns1.example.com admin.example.com -serial 2024010101 -refresh 3600 -retry 600 -expire 86400 -minimum 3600

# == GSLB Service Monitors ==
add lb monitor gslb_http_mon HTTP -respCode 200 -httpRequest "GET /health HTTP/1.1\r\nHost: www.example.com\r\n\r\n"
bind gslb service gslb_svc_dc1_web -monitorName gslb_http_mon
bind gslb service gslb_svc_dc2_web -monitorName gslb_http_mon

# == GSLB Sync Configuration ==
set gslb parameter -ldnsEntryTimeout 30 -automaticconfigsync ENABLED
