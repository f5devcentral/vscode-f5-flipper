# Section 1.5: Compression Policies
# Tests: cmp policy, cmp action
# CMP feature already enabled

# Compression Policies (use resAction for response-based compression)
add cmp policy cmp_pol_text -rule "HTTP.RES.HEADER(\"Content-Type\").CONTAINS(\"text\")" -resAction COMPRESS
add cmp policy cmp_pol_json -rule "HTTP.RES.HEADER(\"Content-Type\").CONTAINS(\"json\")" -resAction COMPRESS
add cmp policy cmp_pol_nocompress -rule "HTTP.RES.HEADER(\"Content-Encoding\").EXISTS" -resAction NOCOMPRESS

# Backend and vserver
add server cmp_server 10.10.10.40
add serviceGroup sg_cmp HTTP
bind serviceGroup sg_cmp cmp_server 80
add lb vserver vs_cmp HTTP 10.1.1.120 80
bind lb vserver vs_cmp sg_cmp

# Bind compression policies globally (cmp policies bind globally, not to vservers)
bind cmp global cmp_pol_text -priority 100 -gotoPriorityExpression END -type RES_DEFAULT
bind cmp global cmp_pol_json -priority 200 -gotoPriorityExpression END -type RES_DEFAULT
