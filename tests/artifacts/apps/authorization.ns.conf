# Section 1.6: Authorization Policies
# Tests: authorization action, authorization policy
# Requires: enable ns feature AAA
#
# KEY FINDING: Authorization policy uses POSITIONAL arguments, not -rule/-action
# Syntax: add authorization policy <name> <rule> <action>
# NOT: add authorization policy <name> -rule "expr" -action <action>

# Authorization Actions
add authorization action authz_act_allow ALLOW
add authorization action authz_act_deny DENY

# Authorization Policies (positional: name rule action)
add authorization policy authz_pol_admin "HTTP.REQ.URL.CONTAINS(\"/admin/\")" authz_act_allow
add authorization policy authz_pol_deny_all "true" authz_act_deny

# Backend and vserver for binding
add server authz_server 10.10.10.60
add serviceGroup sg_authz HTTP
bind serviceGroup sg_authz authz_server 80
add lb vserver vs_authz HTTP 10.1.1.140 80
bind lb vserver vs_authz sg_authz

# Bind authorization policies to vserver
bind lb vserver vs_authz -policyName authz_pol_admin -priority 100 -gotoPriorityExpression END -type REQUEST
bind lb vserver vs_authz -policyName authz_pol_deny_all -priority 200 -gotoPriorityExpression END -type REQUEST
