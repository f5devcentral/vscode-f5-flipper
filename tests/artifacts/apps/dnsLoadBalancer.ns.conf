#NS13.1 Build 37.38
# Last modified by `save config`, Mon May 03 12:34:56 2555

# DNS Load Balancer Configuration
# Example: Multi-site DNS load balancing with geographic distribution

# DNS Virtual Server - Load balances DNS queries across multiple sites
add lb vserver dns_lb_vs DNS 192.168.1.10 53 -persistenceType NONE -cltTimeout 120

# Primary Site Service Group (East Coast)
add serviceGroup dns_east_sg DNS -maxClient 0 -maxReq 0 -cip DISABLED -usip NO -useproxyport NO -cltTimeout 120 -svrTimeout 120 -CKA NO -TCPB NO -CMP NO

# Primary Site DNS Servers
add server dns_east_primary 10.1.1.25 -comment "Primary DNS East Coast"
add server dns_east_secondary 10.1.1.26 -comment "Secondary DNS East Coast"

# Bind primary site servers
bind serviceGroup dns_east_sg dns_east_primary 53 -weight 100
bind serviceGroup dns_east_sg dns_east_secondary 53 -weight 100

# Secondary Site Service Group (West Coast)
add serviceGroup dns_west_sg DNS -maxClient 0 -maxReq 0 -cip DISABLED -usip NO -useproxyport NO -cltTimeout 120 -svrTimeout 120 -CKA NO -TCPB NO -CMP NO

# Secondary Site DNS Server
add server dns_west_primary 10.2.1.25 -comment "Primary DNS West Coast"

# Bind secondary site server
bind serviceGroup dns_west_sg dns_west_primary 53

# DNS Health Monitor - Uses actual DNS queries
add lb monitor dns_health_mon DNS -query . -queryType Address -LRTM DISABLED -destPort 53

# Bind health monitors to service groups
bind serviceGroup dns_east_sg -monitorName dns_health_mon -weight 100
bind serviceGroup dns_west_sg -monitorName dns_health_mon

# Bind service groups to virtual server
bind lb vserver dns_lb_vs dns_east_sg
bind lb vserver dns_lb_vs dns_west_sg
