title: Simple DNS Application Template
description: Layer 4 DNS Load Balancer Application - DNS Protocol on Port 53
contentType: application/json
definitions:
  tenant_name:
    title: Tenant name
    type: string
    propertyOrder: 1
  app_name:
    title: Application name
    type: string
    propertyOrder: 2
    options:
      input_width: 300px
  virtual_address:
    title: Virtual address
    propertyOrder: 3
    type: string
    options:
      input_width: 300px
  virtual_port:
    title: Virtual port
    propertyOrder: 4
    default: 53
    type: integer
    options:
      input_width: 300px
  icmp_echo:
    type: string
    title: ICMP echo
    enum:
      - enable
      - disable
      - selective
    default: enable
  arpEnabled:
    title: ARP enabled
    type: boolean
    default: true
  idleTimeout:
    type: integer
    propertyOrder: 5
    default: 120
    title: Idle timeout
    options:
      input_width: 300px
  lbMethod:
    title: Load balancing method
    type: string
    enum:
      - round-robin
      - least-connections-member
    default: round-robin
    propertyOrder: 6
    options:
      input_width: 300px
  pool_members:
    title: Static Pool members
    description: List of DNS server pool members
    uniqueItems: true
    type: array
    items:
      type: object
      properties:
        name:
          title: Name
          type: string
          propertyOrder: 1
        address:
          title: Address
          type: string
          propertyOrder: 2
        port:
          title: Port
          type: number
          default: 53
          propertyOrder: 3
          options:
            input_width: 80px
        shareNodes:
          title: Shared nodes
          type: boolean
          default: false
          propertyOrder: 4
        adminState:
          title: Admin State
          description: Enabled
          type: boolean
          default: true
      required:
        - port
        - address
  fqdn_members:
    title: FQDN Pool members
    description: List of FQDN DNS server pool members
    uniqueItems: true
    type: array
    items:
      type: object
      properties:
        hostname:
          title: FQDN
          type: string
        port:
          title: Port
          type: string
          default: "53"
        adminState:
          title: Admin State
          description: Enabled
          type: boolean
          default: true
        shareNodes:
          title: Shared nodes
          type: boolean
          default: false
      required:
        - hostname
        - port

template: |
    {
        "$schema": "https://raw.githubusercontent.com/F5Networks/f5-appsvcs-extension/master/schema/latest/as3-schema.json",
        "class": "AS3",
        "declaration": {
            "class": "ADC",
            "schemaVersion": "3.45.0",
            "id": "urn:uuid:298cd391-c79c-422a-98bf-f4f559f5f591",
            "label": "Converted from NS by F5 flipper",
            "remark": "DNS load balancer - be sure to test application thoroughly",
            "t_{{virtual_address}}": {
                "class": "Tenant",
                "{{app_name}}_app": {
                    "class": "Application",
                    "template": "shared",
                    "sa_{{virtual_address}}": {
                        "class": "Service_Address",
                        "icmpEcho": {{icmp_echo}},
                        "arpEnabled": {{arpEnabled}},
                        "virtualAddress": "{{virtual_address}}"
                    },
                    "{{app_name}}": {
                        "layer4": "udp",
                        "pool": "pool_{{app_name}}",
                        "translateServerAddress": true,
                        "translateServerPort": true,
                        "class": "Service_UDP",
                        "profileUDP": {
                            "use": "{{app_name}}-udp"
                        },
                        "virtualAddresses": [
                            { "use": "sa_{{virtual_address}}" }
                        ],
                        "virtualPort": {{virtual_port}},
                        "snat": "auto"
                    },
                    "pool_{{app_name}}": {
                        "members": [
                            {{#pool_members}}
                            {
                            "addressDiscovery": "static",
                            "servers": [{
                            {{#name}}
                                "name": "{{name}}",
                            {{/name}}
                                "address": "{{address}}"
                            }],
                            "servicePort": {{port}},
                            {{#shareNodes}}"shareNodes": true,{{/shareNodes}}
                            {{^adminState}}"adminState": "disable"{{/adminState}}
                            },
                            {{/pool_members}}
                            {{#fqdn_members}}
                            {
                            "addressDiscovery": "fqdn",
                            "hostname": {{hostname}},
                            "servicePort": {{port}},
                            {{#shareNodes}}"shareNodes": true,{{/shareNodes}}
                            {{^adminState}}"adminState": "disable"{{/adminState}}
                            },
                            {{/fqdn_members}}
                        ],
                        "monitors": [
                            {
                                "bigip": "/Common/gateway_icmp"
                            }
                        ],
                        {{#lbMethod}}
                            "loadBalancingMode":"{{lbMethod}}",
                        {{/lbMethod}}
                        "class": "Pool"
                    },
                    "{{app_name}}-udp": {
                        "idleTimeout": {{idleTimeout}},
                    "class": "UDP_Profile"
                    }
                }
            }
        }
    }
